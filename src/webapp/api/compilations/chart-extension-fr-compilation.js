

/* compile-prolog.js */
window.Exhibit_ChartExtension_isCompiled=true;


/* chart-extension.js */
(function(){var G=("Exhibit_ChartExtension_isCompiled" in window)&&window.Exhibit_ChartExtension_isCompiled;
Exhibit.ChartExtension={params:{bundle:true}};
var H=["scatter-plot-view.js","pivot-table-view.js","bar-chart-view.js"];
var B=["scatter-plot-view.css","pivot-table-view.css","bar-chart-view.css"];
var F={bundle:Boolean};
if(typeof Exhibit_ChartExtension_urlPrefix=="string"){Exhibit.ChartExtension.urlPrefix=Exhibit_ChartExtension_urlPrefix;
if("Exhibit_ChartExtension_parameters" in window){SimileAjax.parseURLParameters(Exhibit_ChartExtension_parameters,Exhibit.ChartExtension.params,F);
}}else{var D=SimileAjax.findScript(document,"/chart-extension.js");
if(D==null){SimileAjax.Debug.exception(new Error("Failed to derive URL prefix for Simile Exhibit Chart Extension code files"));
return ;
}Exhibit.ChartExtension.urlPrefix=D.substr(0,D.indexOf("chart-extension.js"));
SimileAjax.parseURLParameters(D,Exhibit.ChartExtension.params,F);
}var A=[];
var C=[];
if(Exhibit.ChartExtension.params.bundle){A.push(Exhibit.ChartExtension.urlPrefix+"chart-extension-bundle.js");
C.push(Exhibit.ChartExtension.urlPrefix+"chart-extension-bundle.css");
}else{SimileAjax.prefixURLs(A,Exhibit.ChartExtension.urlPrefix+"scripts/",H);
SimileAjax.prefixURLs(C,Exhibit.ChartExtension.urlPrefix+"styles/",B);
}for(var E=0;
E<Exhibit.locales.length;
E++){A.push(Exhibit.ChartExtension.urlPrefix+"locales/"+Exhibit.locales[E]+"/chart-locale.js");
}if(!G){SimileAjax.includeJavascriptFiles(document,"",A);
SimileAjax.includeCssFiles(document,"",C);
}})();


/* chart-extension-bundle.js */
Exhibit.BarChartView=function(E,F){this._div=E;
this._uiContext=F;
this._settings={};
this._accessors={getPointLabel:function(A,B,C){C(B.getObject(A,"label"));
},getProxy:function(A,B,C){C(A);
},getColorKey:null};
this._axisFuncs={x:function(A){return A;
}};
this._axisInverseFuncs={x:function(A){return A;
}};
this._colorKeyCache=new Object();
this._maxColor=0;
var D=this;
this._listener={onItemsChanged:function(){D._reconstruct();
}};
F.getCollection().addListener(this._listener);
};
Exhibit.BarChartView._settingSpecs={"plotHeight":{type:"int",defaultValue:400},"bubbleWidth":{type:"int",defaultValue:400},"bubbleHeight":{type:"int",defaultValue:300},"xAxisMin":{type:"float",defaultValue:Number.POSITIVE_INFINITY},"xAxisMax":{type:"float",defaultValue:Number.NEGATIVE_INFINITY},"xAxisType":{type:"enum",defaultValue:"linear",choices:["linear","log"]},"yAxisMin":{type:"float",defaultValue:Number.POSITIVE_INFINITY},"yAxisMax":{type:"float",defaultValue:Number.NEGATIVE_INFINITY},"yAxisType":{type:"enum",defaultValue:"linear",choices:["linear","log"]},"xLabel":{type:"text",defaultValue:"x"},"yLabel":{type:"text",defaultValue:"y"},"color":{type:"text",defaultValue:"#5D7CBA"},"colorCoder":{type:"text",defaultValue:null},"scroll":{type:"boolean",defaultValue:false}};
Exhibit.BarChartView._accessorSpecs=[{accessorName:"getProxy",attributeName:"proxy"},{accessorName:"getPointLabel",attributeName:"pointLabel"},{accessorName:"getXY",alternatives:[{bindings:[{attributeName:"xy",types:["float","text"],bindingNames:["x","y"]}]},{bindings:[{attributeName:"x",type:"float",bindingName:"x"},{attributeName:"y",type:"text",bindingName:"y"}]}]},{accessorName:"getColorKey",attributeName:"colorKey",type:"text"}];
Exhibit.BarChartView.create=function(F,G,H){var E=new Exhibit.BarChartView(G,Exhibit.UIContext.create(F,H));
Exhibit.BarChartView._configure(E,F);
E._internalValidate();
E._initializeUI();
return E;
};
Exhibit.BarChartView.createFromDOM=function(H,I,J){var G=Exhibit.getConfigurationFromDOM(H);
var F=new Exhibit.BarChartView(I!=null?I:H,Exhibit.UIContext.createFromDOM(H,J));
Exhibit.SettingsUtilities.createAccessorsFromDOM(H,Exhibit.BarChartView._accessorSpecs,F._accessors);
Exhibit.SettingsUtilities.collectSettingsFromDOM(H,Exhibit.BarChartView._settingSpecs,F._settings);
Exhibit.BarChartView._configure(F,G);
F._internalValidate();
F._initializeUI();
return F;
};
Exhibit.BarChartView._configure=function(D,E){Exhibit.SettingsUtilities.createAccessors(E,Exhibit.BarChartView._accessorSpecs,D._accessors);
Exhibit.SettingsUtilities.collectSettings(E,Exhibit.BarChartView._settingSpecs,D._settings);
D._axisFuncs.x=Exhibit.BarChartView._getAxisFunc(D._settings.xAxisType);
D._axisInverseFuncs.x=Exhibit.BarChartView._getAxisInverseFunc(D._settings.xAxisType);
var F=D._accessors;
D._getXY=function(A,B,C){F.getProxy(A,B,function(H){F.getXY(H,B,C);
});
};
};
Exhibit.BarChartView._getAxisFunc=function(B){if(B=="log"){return function(A){return(Math.log(A)/Math.log(10));
};
}else{return function(A){return A;
};
}};
Exhibit.BarChartView._getAxisInverseFunc=function(B){if(B=="log"){return function(A){return Math.pow(10,A);
};
}else{return function(A){return A;
};
}};
Exhibit.BarChartView._colors=["FF9000","5D7CBA","A97838","8B9BBA","FFC77F","003EBA","29447B","543C1C"];
Exhibit.BarChartView._mixColor="FFFFFF";
Exhibit.BarChartView.evaluateSingle=function(E,F,D){return E.evaluateSingleOnItem(F,D).value;
};
Exhibit.BarChartView.prototype.dispose=function(){this._uiContext.getCollection().removeListener(this._listener);
this._toolboxWidget.dispose();
this._toolboxWidget=null;
this._dom.dispose();
this._dom=null;
this._uiContext.dispose();
this._uiContext=null;
this._div.innerHTML="";
this._div=null;
};
Exhibit.BarChartView.prototype._internalValidate=function(){if("getColorKey" in this._accessors){if("colorCoder" in this._settings){this._colorCoder=this._uiContext.getExhibit().getComponent(this._settings.colorCoder);
}if(this._colorCoder==null){this._colorCoder=new Exhibit.DefaultColorCoder(this._uiContext);
}}};
Exhibit.BarChartView.prototype._initializeUI=function(){var C=this;
var D="_gradientPoints" in this._colorCoder?"gradient":{};
this._div.innerHTML="";
this._dom=Exhibit.ViewUtilities.constructPlottingViewDom(this._div,this._uiContext,true,{onResize:function(){C._reconstruct();
}},D);
this._toolboxWidget=Exhibit.ToolboxWidget.createFromDOM(this._div,this._div,this._uiContext);
this._dom.plotContainer.className="exhibit-barChartView-plotContainer";
this._dom.plotContainer.style.height=this._settings.plotHeight+"px";
this._reconstruct();
};
Exhibit.BarChartView.prototype._reconstruct=function(){var AR=this;
var Ap=this._uiContext.getCollection();
var Ai=this._uiContext.getDatabase();
var AZ=this._settings;
var AY=this._accessors;
this._dom.plotContainer.innerHTML="";
var Aq=AR._axisFuncs.x;
var AU=AR._axisInverseFuncs.x;
var AL=Ap.countRestrictedItems();
var AQ=[];
this._dom.legendWidget.clear();
if(AL>0){var AG=Ap.getRestrictedItems();
var AM=(this._accessors.getColorKey!=null);
var AF={};
var z=AZ.xAxisMin;
var AT=AZ.xAxisMax;
AG.visit(function(D){var C=[];
AR._getXY(D,Ai,function(I){if("x" in I&&"y" in I){C.push(I);
}});
if(C.length>0){var B=null;
if(AM){B=new Exhibit.Set();
AY.getColorKey(D,Ai,function(I){B.add(I);
});
}for(var A=0;
A<C.length;
A++){var E=C[A];
var H=E.x+","+E.y;
if(H in AF){var G=AF[H];
G.items.push(D);
if(AM){G.colorKeys.addSet(B);
}}else{try{E.scaledX=Aq(E.x);
if(!isFinite(E.scaledX)){continue;
}}catch(F){continue;
}var G={xy:E,items:[D]};
if(AM){G.colorKeys=B;
}AF[H]=G;
z=Math.min(z,E.scaledX);
AT=Math.max(AT,E.scaledX);
}}}else{AQ.push(D);
}});
var AC=AT-z;
var Ao=1;
if(AC>1){while(Ao*20<AC){Ao*=10;
}}else{while(Ao<AC*20){Ao/=10;
}}z=Math.floor(z/Ao)*Ao;
AT=Math.ceil(AT/Ao)*Ao;
AZ.xAxisMin=z;
AZ.xAxisMax=AT;
var Af=document.createElement("div");
Af.className=SimileAjax.Platform.browser.isIE?"exhibit-barChartView-canvasFrame-ie":"exhibit-barChartView-canvasFrame";
this._dom.plotContainer.appendChild(Af);
if(AR._settings.scroll){Af.style.overflow="scroll";
}var x=document.createElement("table");
var An=document.createElement("tbody");
var Ac=document.createElement("tr");
var AW=document.createElement("td");
var AJ=document.createElement("td");
var Aj=document.createElement("div");
var AH=document.createElement("div");
x.style.width="100%";
AH.style.position="relative";
AH.style.width="100%";
AW.appendChild(Aj);
AJ.appendChild(AH);
Ac.appendChild(AW);
Ac.appendChild(AJ);
An.appendChild(Ac);
x.appendChild(An);
Af.appendChild(x);
var AO=document.createElement("div");
AO.className="exhibit-barChartView-canvas";
AO.style.height="100%";
AH.appendChild(AO);
var k=document.createElement("div");
k.className=SimileAjax.Platform.browser.isIE?"exhibit-barChartView-yAxis-ie":"exhibit-barChartView-yAxis";
this._dom.plotContainer.appendChild(k);
var Ah=document.createElement("div");
Ah.style.position="relative";
Ah.style.height="100%";
k.appendChild(Ah);
var AX=document.createElement("div");
AX.className="exhibit-barChartView-yAxisName";
AX.innerHTML=AZ.yLabel;
Ah.appendChild(AX);
var Am={mixed:false,missing:false,others:false,keys:new Exhibit.Set()};
var AI=function(A){var E=A.items;
var H=AZ.color;
if(AM){H=AR._colorCoder.translateSet(A.colorKeys,Am);
}var D=A.xy;
var G=document.createElement("div");
var C=document.createTextNode(D.y);
G.appendChild(C);
G.style.height="1.5em";
Aj.appendChild(G);
var B=document.createElement("div");
B.style.position="relative";
B.style.height="1.5em";
B.style.zIndex="2";
var F=document.createElement("div");
F.className="exhibit-barChartView-bar";
F.style.backgroundColor=H;
F.style.textAlign="right";
F.style.left="0";
var I=Math.floor(100*(Aq(D.x)-z)/(AT-z));
F.style.width=I+"%";
F.style.borderStyle="solid";
F.style.borderWidth="1px";
F.style.paddingLeft="0px";
var C=document.createTextNode(D.x);
F.appendChild(C);
B.appendChild(F);
AO.appendChild(B);
SimileAjax.WindowManager.registerEvent(F,"click",function(K,L,J){AR._openPopup(F,E);
});
SimileAjax.WindowManager.registerEvent(G,"click",function(K,L,J){AR._openPopup(G,E);
});
};
for(xyKey in AF){AI(AF[xyKey]);
}AW.style.width="1px";
x.style.tableLayout="auto";
var AB=document.createElement("div");
AB.className="exhibit-barChartView-xAxis";
var AV=document.createElement("div");
AV.style.position="relative";
AV.style.left=0;
AB.appendChild(AV);
var Ag=AO.offsetWidth;
var AP=AO.offsetHeight;
var AN=Ag/(AT-z);
AO.style.display="none";
var Al=function(A,B){if(A>=1000000){return function(C){return Math.floor(B(C)/1000000)+"M";
};
}else{if(A>=1000){return function(C){return Math.floor(B(C)/1000)+"K";
};
}else{return function(C){return B(C);
};
}}};
var y=Al(Ao,AU);
for(var Ak=z+Ao;
Ak<AT;
Ak+=Ao){var AS=Math.floor((Ak-z)*AN);
var Aa=document.createElement("div");
Aa.className="exhibit-barChartView-gridLine";
Aa.style.width="1px";
Aa.style.left=AS+"px";
Aa.style.top="0px";
Aa.style.height="100%";
Aa.style.zIndex="1";
AO.appendChild(Aa);
var AA=document.createElement("div");
AA.className="exhibit-barChartView-xAxisLabel";
AA.style.left=AS+"px";
AA.innerHTML=y(Ak);
AV.appendChild(AA);
}var Ad=document.createElement("div");
Ad.className="exhibit-barChartView-xAxisName";
Ad.innerHTML=AZ.xLabel;
AV.appendChild(Ad);
AH.appendChild(AB);
AO.style.display="block";
if(AM){var Ar=this._dom.legendWidget;
var Ab=this._colorCoder;
var AE=Am.keys.toArray().sort();
if(this._colorCoder._gradientPoints!=null){Ar.addGradient(this._colorCoder._gradientPoints);
}else{for(var Ae=0;
Ae<AE.length;
Ae++){var AK=AE[Ae];
var AD=Ab.translate(AK);
Ar.addEntry(AD,AK);
}}if(Am.others){Ar.addEntry(Ab.getOthersColor(),Ab.getOthersLabel());
}if(Am.mixed){Ar.addEntry(Ab.getMixedColor(),Ab.getMixedLabel());
}if(Am.missing){Ar.addEntry(Ab.getMissingColor(),Ab.getMissingLabel());
}}}this._dom.setUnplottableMessage(AL,AQ);
};
Exhibit.BarChartView.prototype._openPopup=function(D,C){Exhibit.ViewUtilities.openBubbleForItems(D,C,this._uiContext);
};
Exhibit.PivotTableView=function(E,F){this._div=E;
this._uiContext=F;
this._rowPath=null;
this._columnPath=null;
this._cellExpression=null;
this._settings={};
var D=this;
this._listener={onItemsChanged:function(){D._reconstruct();
}};
F.getCollection().addListener(this._listener);
};
Exhibit.PivotTableView.create=function(F,G,H){var E=new Exhibit.PivotTableView(G,Exhibit.UIContext.create(F,H));
Exhibit.PivotTableView._configure(E,F);
E._initializeUI();
return E;
};
Exhibit.PivotTableView.createFromDOM=function(H,I,J){var G=Exhibit.getConfigurationFromDOM(H);
var F=new Exhibit.PivotTableView(I!=null?I:H,Exhibit.UIContext.createFromDOM(H,J));
F._columnPath=Exhibit.PivotTableView._parsePath(Exhibit.getAttribute(H,"column"));
F._rowPath=Exhibit.PivotTableView._parsePath(Exhibit.getAttribute(H,"row"));
F._cellExpression=Exhibit.PivotTableView._parseExpression(Exhibit.getAttribute(H,"cell"));
Exhibit.PivotTableView._configure(F,G);
F._initializeUI();
return F;
};
Exhibit.PivotTableView._configure=function(C,D){if("column" in D){C._columnPath=Exhibit.PivotTableView._parsePath(D.column);
}if("row" in D){C._rowPath=Exhibit.PivotTableView._parsePath(D.row);
}if("cell" in D){C._cellExpression=Exhibit.PivotTableView._parseExpression(D.cell);
}};
Exhibit.PivotTableView._parseExpression=function(C){try{return Exhibit.ExpressionParser.parse(C);
}catch(D){SimileAjax.Debug.exception(D,"Error parsing expression "+C);
}return null;
};
Exhibit.PivotTableView._parsePath=function(D){try{var E=Exhibit.ExpressionParser.parse(D);
if(E.isPath()){return E.getPath();
}else{SimileAjax.Debug.log("Expecting a path but got a full expression: "+D);
}}catch(F){SimileAjax.Debug.exception(F,"Error parsing expression "+D);
}return null;
};
Exhibit.PivotTableView.prototype.dispose=function(){this._uiContext.getCollection().removeListener(this._listener);
this._toolboxWidget.dispose();
this._toolboxWidget=null;
this._collectionSummaryWidget.dispose();
this._collectionSummaryWidget=null;
this._uiContext.dispose();
this._uiContext=null;
this._div.innerHTML="";
this._dom=null;
this._div=null;
};
Exhibit.PivotTableView.prototype._initializeUI=function(){var B=this;
this._div.innerHTML="";
this._dom=Exhibit.PivotTableView.constructDom(this._div);
this._collectionSummaryWidget=Exhibit.CollectionSummaryWidget.create({},this._dom.collectionSummaryDiv,this._uiContext);
this._toolboxWidget=Exhibit.ToolboxWidget.createFromDOM(this._div,this._div,this._uiContext);
this._reconstruct();
};
Exhibit.PivotTableView.prototype._reconstruct=function(){this._dom.tableContainer.innerHTML="";
var C=this._uiContext.getCollection().countRestrictedItems();
if(C>0){var D=this._uiContext.getCollection().getRestrictedItems();
if(this._columnPath!=null&&this._rowPath!=null&&this._cellExpression!=null){this._makeTable(D);
}}};
Exhibit.PivotTableView.prototype._makeTable=function(j){var k=this;
var m=this._uiContext.getDatabase();
var w=this._rowPath.walkForward(j,"item",m).getSet();
var q=this._columnPath.walkForward(j,"item",m).getSet();
var i=Exhibit.PivotTableView._sortValues(w);
var v=Exhibit.PivotTableView._sortValues(q);
var n=i.length;
var b=v.length;
var a="#eee";
var u="#fff";
var e=document.createElement("table");
e.cellPadding=2;
e.cellSpacing=0;
var g=0;
var y,p;
for(var c=0;
c<b;
c++){var o=0;
y=e.insertRow(g++);
p=y.insertCell(o++);
if(c>0){p=y.insertCell(o++);
p.rowSpan=b-c+1;
p.style.backgroundColor=(c%2)==0?u:a;
p.innerHTML="\u00a0";
}p=y.insertCell(o++);
p.colSpan=b-c+1;
p.style.backgroundColor=(c%2)==1?u:a;
p.innerHTML=v[c].label;
}y=e.insertRow(g++);
p=y.insertCell(0);
p=y.insertCell(1);
p.style.backgroundColor=(b%2)==0?u:a;
p.innerHTML="\u00a0";
p=y.insertCell(2);
for(var l=0;
l<n;
l++){var o=0;
var x=i[l];
var f=x.value;
y=e.insertRow(g++);
p=y.insertCell(o++);
p.innerHTML=i[l].label;
p.style.borderBottom="1px solid #aaa";
var h=this._rowPath.evaluateBackward(f,w.valueType,j,m).getSet();
for(var c=0;
c<b;
c++){var d=v[c];
var s=d.value;
p=y.insertCell(o++);
p.style.backgroundColor=(c%2)==1?u:a;
p.style.borderBottom="1px solid #ccc";
p.title=x.label+" / "+d.label;
var t=this._columnPath.evaluateBackward(s,q.valueType,h,m);
var z=this._cellExpression.evaluate({"value":t.getSet()},{"value":t.valueType},"value",m);
if(z.valueType=="number"&&z.values.size()==1){z.values.visit(function(A){if(A!=0){p.appendChild(document.createTextNode(A));
}else{p.appendChild(document.createTextNode("\u00a0"));
}});
}else{var r=true;
z.values.visit(function(A){if(r){r=false;
}else{p.appendChild(document.createTextNode(", "));
}p.appendChild(document.createTextNode(A));
});
}}}this._dom.tableContainer.appendChild(e);
};
Exhibit.PivotTableView._sortValues=function(H,F,G){var E=[];
H.visit(F=="item"?function(B){var A=G.getObject(B,"label");
E.push({value:B,label:A!=null?A:B});
}:function(A){E.push({value:A,label:A});
});
E.sort(function(B,C){var A=B.label.localeCompare(C.label);
return A!=null?A:B.value.localeCompare(C.value);
});
return E;
};
Exhibit.PivotTableView.prototype._openPopup=function(M,R){var P=SimileAjax.DOM.getPageCoordinates(M);
var Q=SimileAjax.Graphics.createBubbleForPoint(P.left+Math.round(M.offsetWidth/2),P.top+Math.round(M.offsetHeight/2),400,300);
if(R.length>1){var J=document.createElement("ul");
for(var K=0;
K<R.length;
K++){var O=document.createElement("li");
O.appendChild(Exhibit.UI.makeItemSpan(R[K],null,this._uiContext));
J.appendChild(O);
}Q.content.appendChild(J);
}else{var N=document.createElement("div");
var L=this._uiContext.getLensRegistry().createLens(R[0],N,this._uiContext);
Q.content.appendChild(N);
}};
Exhibit.PivotTableView.constructDom=function(E){var D=Exhibit.PivotTableView.l10n;
var F={elmt:E,children:[{tag:"div",className:"exhibit-collectionView-header",field:"collectionSummaryDiv"},{tag:"div",field:"tableContainer",className:"exhibit-pivotTableView-tableContainer"}]};
return SimileAjax.DOM.createDOMFromTemplate(F);
};
Exhibit.ScatterPlotView=function(E,F){this._div=E;
this._uiContext=F;
this._settings={};
this._accessors={getPointLabel:function(A,B,C){C(B.getObject(A,"label"));
},getProxy:function(A,B,C){C(A);
},getColorKey:null};
this._axisFuncs={x:function(A){return A;
},y:function(A){return A;
}};
this._axisInverseFuncs={x:function(A){return A;
},y:function(A){return A;
}};
this._colorKeyCache=new Object();
this._maxColor=0;
var D=this;
this._listener={onItemsChanged:function(){D._reconstruct();
}};
F.getCollection().addListener(this._listener);
};
Exhibit.ScatterPlotView._settingSpecs={"plotHeight":{type:"int",defaultValue:400},"bubbleWidth":{type:"int",defaultValue:400},"bubbleHeight":{type:"int",defaultValue:300},"xAxisMin":{type:"float",defaultValue:Number.POSITIVE_INFINITY},"xAxisMax":{type:"float",defaultValue:Number.NEGATIVE_INFINITY},"xAxisType":{type:"enum",defaultValue:"linear",choices:["linear","log"]},"yAxisMin":{type:"float",defaultValue:Number.POSITIVE_INFINITY},"yAxisMax":{type:"float",defaultValue:Number.NEGATIVE_INFINITY},"yAxisType":{type:"enum",defaultValue:"linear",choices:["linear","log"]},"xLabel":{type:"text",defaultValue:"x"},"yLabel":{type:"text",defaultValue:"y"},"color":{type:"text",defaultValue:"#0000aa"},"colorCoder":{type:"text",defaultValue:null}};
Exhibit.ScatterPlotView._accessorSpecs=[{accessorName:"getProxy",attributeName:"proxy"},{accessorName:"getPointLabel",attributeName:"pointLabel"},{accessorName:"getXY",alternatives:[{bindings:[{attributeName:"xy",types:["float","float"],bindingNames:["x","y"]}]},{bindings:[{attributeName:"x",type:"float",bindingName:"x"},{attributeName:"y",type:"float",bindingName:"y"}]}]},{accessorName:"getColorKey",attributeName:"colorKey",type:"text"}];
Exhibit.ScatterPlotView.create=function(F,G,H){var E=new Exhibit.ScatterPlotView(G,Exhibit.UIContext.create(F,H));
Exhibit.ScatterPlotView._configure(E,F);
E._internalValidate();
E._initializeUI();
return E;
};
Exhibit.ScatterPlotView.createFromDOM=function(H,I,J){var G=Exhibit.getConfigurationFromDOM(H);
var F=new Exhibit.ScatterPlotView(I!=null?I:H,Exhibit.UIContext.createFromDOM(H,J));
Exhibit.SettingsUtilities.createAccessorsFromDOM(H,Exhibit.ScatterPlotView._accessorSpecs,F._accessors);
Exhibit.SettingsUtilities.collectSettingsFromDOM(H,Exhibit.ScatterPlotView._settingSpecs,F._settings);
Exhibit.ScatterPlotView._configure(F,G);
F._internalValidate();
F._initializeUI();
return F;
};
Exhibit.ScatterPlotView._configure=function(D,E){Exhibit.SettingsUtilities.createAccessors(E,Exhibit.ScatterPlotView._accessorSpecs,D._accessors);
Exhibit.SettingsUtilities.collectSettings(E,Exhibit.ScatterPlotView._settingSpecs,D._settings);
D._axisFuncs.x=Exhibit.ScatterPlotView._getAxisFunc(D._settings.xAxisType);
D._axisInverseFuncs.x=Exhibit.ScatterPlotView._getAxisInverseFunc(D._settings.xAxisType);
D._axisFuncs.y=Exhibit.ScatterPlotView._getAxisFunc(D._settings.yAxisType);
D._axisInverseFuncs.y=Exhibit.ScatterPlotView._getAxisInverseFunc(D._settings.yAxisType);
var F=D._accessors;
D._getXY=function(A,B,C){F.getProxy(A,B,function(H){F.getXY(H,B,C);
});
};
};
Exhibit.ScatterPlotView._getAxisFunc=function(B){if(B=="log"){return function(A){return(Math.log(A)/Math.log(10));
};
}else{return function(A){return A;
};
}};
Exhibit.ScatterPlotView._getAxisInverseFunc=function(B){if(B=="log"){return function(A){return Math.pow(10,A);
};
}else{return function(A){return A;
};
}};
Exhibit.ScatterPlotView._colors=["FF9000","5D7CBA","A97838","8B9BBA","FFC77F","003EBA","29447B","543C1C"];
Exhibit.ScatterPlotView._mixColor="FFFFFF";
Exhibit.ScatterPlotView.evaluateSingle=function(E,F,D){return E.evaluateSingleOnItem(F,D).value;
};
Exhibit.ScatterPlotView.prototype.dispose=function(){this._uiContext.getCollection().removeListener(this._listener);
this._toolboxWidget.dispose();
this._toolboxWidget=null;
this._dom.dispose();
this._dom=null;
this._uiContext.dispose();
this._uiContext=null;
this._div.innerHTML="";
this._div=null;
};
Exhibit.ScatterPlotView.prototype._internalValidate=function(){if("getColorKey" in this._accessors){if("colorCoder" in this._settings){this._colorCoder=this._uiContext.getExhibit().getComponent(this._settings.colorCoder);
}if(this._colorCoder==null){this._colorCoder=new Exhibit.DefaultColorCoder(this._uiContext);
}}};
Exhibit.ScatterPlotView.prototype._initializeUI=function(){var C=this;
var D="_gradientPoints" in this._colorCoder?"gradient":{};
this._div.innerHTML="";
this._dom=Exhibit.ViewUtilities.constructPlottingViewDom(this._div,this._uiContext,true,{onResize:function(){C._reconstruct();
}},D);
this._toolboxWidget=Exhibit.ToolboxWidget.createFromDOM(this._div,this._div,this._uiContext);
this._dom.plotContainer.className="exhibit-scatterPlotView-plotContainer";
this._dom.plotContainer.style.height=this._settings.plotHeight+"px";
this._reconstruct();
};
Exhibit.ScatterPlotView.prototype._reconstruct=function(){var AS=this;
var Aq=this._uiContext.getCollection();
var Ak=this._uiContext.getDatabase();
var Ab=this._settings;
var AG=this._accessors;
this._dom.plotContainer.innerHTML="";
var As=AS._axisFuncs.x;
var Au=AS._axisFuncs.y;
var AX=AS._axisInverseFuncs.x;
var AZ=AS._axisInverseFuncs.y;
var AL=Aq.countRestrictedItems();
var AR=[];
this._dom.legendWidget.clear();
if(AL>0){var AJ=Aq.getRestrictedItems();
var AM=(this._accessors.getColorKey!=null);
var AI={};
var k=Ab.xAxisMin;
var AV=Ab.xAxisMax;
var Ar=Ab.yAxisMin;
var AT=Ab.yAxisMax;
AJ.visit(function(D){var C=[];
AS._getXY(D,Ak,function(I){if("x" in I&&"y" in I){C.push(I);
}});
if(C.length>0){var B=null;
if(AM){B=new Exhibit.Set();
AG.getColorKey(D,Ak,function(I){B.add(I);
});
}for(var A=0;
A<C.length;
A++){var E=C[A];
var H=E.x+","+E.y;
if(H in AI){var G=AI[H];
G.items.push(D);
if(AM){G.colorKeys.addSet(B);
}}else{try{E.scaledX=As(E.x);
E.scaledY=Au(E.y);
if(!isFinite(E.scaledX)||!isFinite(E.scaledY)){continue;
}}catch(F){continue;
}var G={xy:E,items:[D]};
if(AM){G.colorKeys=B;
}AI[H]=G;
k=Math.min(k,E.scaledX);
AV=Math.max(AV,E.scaledX);
Ar=Math.min(Ar,E.scaledY);
AT=Math.max(AT,E.scaledY);
}}}else{AR.push(D);
}});
var AE=AV-k;
var AO=AT-Ar;
var Ap=1;
if(AE>1){while(Ap*20<AE){Ap*=10;
}}else{while(Ap<AE*20){Ap/=10;
}}k=Math.floor(k/Ap)*Ap;
AV=Math.ceil(AV/Ap)*Ap;
var AW=1;
if(AO>1){while(AW*20<AO){AW*=10;
}}else{while(AW<AO*20){AW/=10;
}}Ar=Math.floor(Ar/AW)*AW;
AT=Math.ceil(AT/AW)*AW;
Ab.xAxisMin=k;
Ab.xAxisMax=AV;
Ab.yAxisMin=Ar;
Ab.yAxisMax=AT;
var Ag=document.createElement("div");
Ag.className=SimileAjax.Platform.browser.isIE?"exhibit-scatterPlotView-canvasFrame-ie":"exhibit-scatterPlotView-canvasFrame";
this._dom.plotContainer.appendChild(Ag);
var AP=document.createElement("div");
AP.className="exhibit-scatterPlotView-canvas";
AP.style.height="100%";
Ag.appendChild(AP);
var AC=document.createElement("div");
AC.className="exhibit-scatterPlotView-xAxis";
this._dom.plotContainer.appendChild(AC);
var AY=document.createElement("div");
AY.style.position="relative";
AC.appendChild(AY);
var Av=document.createElement("div");
Av.className=SimileAjax.Platform.browser.isIE?"exhibit-scatterPlotView-yAxis-ie":"exhibit-scatterPlotView-yAxis";
this._dom.plotContainer.appendChild(Av);
var Aj=document.createElement("div");
Aj.style.position="relative";
Aj.style.height="100%";
Av.appendChild(Aj);
var Ah=AP.offsetWidth;
var AQ=AP.offsetHeight;
var AN=Ah/(AV-k);
var Ai=AQ/(AT-Ar);
AP.style.display="none";
var Am=function(A,B){if(A>=1000000){return function(C){return Math.floor(B(C)/1000000)+"M";
};
}else{if(A>=1000){return function(C){return Math.floor(B(C)/1000)+"K";
};
}else{return function(C){return B(C);
};
}}};
var Aw=Am(Ap,AX);
var Ax=Am(AW,AZ);
for(var Al=k+Ap;
Al<AV;
Al+=Ap){var AU=Math.floor((Al-k)*AN);
var Ac=document.createElement("div");
Ac.className="exhibit-scatterPlotView-gridLine";
Ac.style.width="1px";
Ac.style.left=AU+"px";
Ac.style.top="0px";
Ac.style.height="100%";
AP.appendChild(Ac);
var x=document.createElement("div");
x.className="exhibit-scatterPlotView-xAxisLabel";
x.style.left=AU+"px";
x.innerHTML=Aw(Al);
AY.appendChild(x);
}var Ae=document.createElement("div");
Ae.className="exhibit-scatterPlotView-xAxisName";
Ae.innerHTML=Ab.xLabel;
AY.appendChild(Ae);
for(var An=Ar+AW;
An<AT;
An+=AW){var Aa=Math.floor((An-Ar)*Ai);
var Ac=document.createElement("div");
Ac.className="exhibit-scatterPlotView-gridLine";
Ac.style.height="1px";
Ac.style.bottom=Aa+"px";
Ac.style.left="0px";
Ac.style.width="100%";
AP.appendChild(Ac);
var x=document.createElement("div");
x.className="exhibit-scatterPlotView-yAxisLabel";
x.style.bottom=Aa+"px";
x.innerHTML=Ax(An);
Aj.appendChild(x);
}var AD=document.createElement("div");
AD.className="exhibit-scatterPlotView-yAxisName";
AD.innerHTML=Ab.yLabel;
Aj.appendChild(AD);
var Ao={mixed:false,missing:false,others:false,keys:new Exhibit.Set()};
var y=function(D){var E=D.items;
var A=Ab.color;
if(AM){A=AS._colorCoder.translateSet(D.colorKeys,Ao);
}var C=D.xy;
var B=Exhibit.ScatterPlotView._makePoint(A,Math.floor((C.scaledX-k)*AN),Math.floor((C.scaledY-Ar)*Ai),D.items+": "+Ab.xLabel+" = "+C.x+", "+Ab.yLabel+" = "+C.y);
SimileAjax.WindowManager.registerEvent(B,"click",function(G,H,F){AS._openPopup(B,E);
});
AP.appendChild(B);
};
for(xyKey in AI){y(AI[xyKey]);
}AP.style.display="block";
if(AM){var At=this._dom.legendWidget;
var Ad=this._colorCoder;
var AH=Ao.keys.toArray().sort();
if(this._colorCoder._gradientPoints!=null){At.addGradient(this._colorCoder._gradientPoints);
}else{for(var Af=0;
Af<AH.length;
Af++){var AK=AH[Af];
var AF=Ad.translate(AK);
At.addEntry(AF,AK);
}}if(Ao.others){At.addEntry(Ad.getOthersColor(),Ad.getOthersLabel());
}if(Ao.mixed){At.addEntry(Ad.getMixedColor(),Ad.getMixedLabel());
}if(Ao.missing){At.addEntry(Ad.getMissingColor(),Ad.getMissingLabel());
}}}this._dom.setUnplottableMessage(AL,AR);
};
Exhibit.ScatterPlotView.prototype._openPopup=function(D,C){Exhibit.ViewUtilities.openBubbleForItems(D,C,this._uiContext);
};
Exhibit.ScatterPlotView._makePoint=function(J,G,F,H){var I=document.createElement("div");
I.innerHTML="<div class='exhibit-scatterPlotView-point' style='background: "+J+"; width: 6px; height: 6px; left: "+(G-3)+"px; bottom: "+(F+3)+"px;' title='"+H+"'></div>";
return I.firstChild;
};


/* chart-locale.js */
if(!("l10n" in Exhibit.ScatterPlotView)){Exhibit.ScatterPlotView.l10n={};
}if(!("l10n" in Exhibit.PivotTableView)){Exhibit.PivotTableView.l10n={};
}Exhibit.ScatterPlotView.l10n.viewLabel="Nuage de points";
Exhibit.ScatterPlotView.l10n.viewTooltip="Voir les items en nuage de points";
Exhibit.PivotTableView.l10n.viewLabel="Nuage de points";
Exhibit.PivotTableView.l10n.viewTooltip="Voir les items sur un tableau pivot";


/* compile-epilog.js */
(function(){var f=null;
if("SimileWidgets_onLoad" in window){if(typeof SimileWidgets_onLoad=="string"){f=eval(SimileWidgets_onLoad);
SimileWidgets_onLoad=null;
}else{if(typeof SimileWidgets_onLoad=="function"){f=SimileWidgets_onLoad;
SimileWidgets_onLoad=null;
}}}if(f!=null){f();
}})();
