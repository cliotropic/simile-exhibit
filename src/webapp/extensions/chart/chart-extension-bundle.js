

/* bar-chart-view.js */
Exhibit.BarChartView=function(C,B){this._div=C;
this._uiContext=B;
this._settings={};
this._accessors={getPointLabel:function(F,E,D){D(E.getObject(F,"label"));
},getProxy:function(F,E,D){D(F);
},getColorKey:null};
this._axisFuncs={x:function(D){return D;
}};
this._axisInverseFuncs={x:function(D){return D;
}};
this._colorKeyCache=new Object();
this._maxColor=0;
var A=this;
this._listener={onItemsChanged:function(){A._reconstruct();
}};
B.getCollection().addListener(this._listener);
};
Exhibit.BarChartView._settingSpecs={"plotHeight":{type:"int",defaultValue:400},"bubbleWidth":{type:"int",defaultValue:400},"bubbleHeight":{type:"int",defaultValue:300},"xAxisMin":{type:"float",defaultValue:Number.POSITIVE_INFINITY},"xAxisMax":{type:"float",defaultValue:Number.NEGATIVE_INFINITY},"xAxisType":{type:"enum",defaultValue:"linear",choices:["linear","log"]},"yAxisMin":{type:"float",defaultValue:Number.POSITIVE_INFINITY},"yAxisMax":{type:"float",defaultValue:Number.NEGATIVE_INFINITY},"yAxisType":{type:"enum",defaultValue:"linear",choices:["linear","log"]},"xLabel":{type:"text",defaultValue:"x"},"yLabel":{type:"text",defaultValue:"y"},"color":{type:"text",defaultValue:"#5D7CBA"},"colorCoder":{type:"text",defaultValue:null},"scroll":{type:"boolean",defaultValue:false}};
Exhibit.BarChartView._accessorSpecs=[{accessorName:"getProxy",attributeName:"proxy"},{accessorName:"getPointLabel",attributeName:"pointLabel"},{accessorName:"getXY",alternatives:[{bindings:[{attributeName:"xy",types:["float","text"],bindingNames:["x","y"]}]},{bindings:[{attributeName:"x",type:"float",bindingName:"x"},{attributeName:"y",type:"text",bindingName:"y"}]}]},{accessorName:"getColorKey",attributeName:"colorKey",type:"text"}];
Exhibit.BarChartView.create=function(D,C,B){var A=new Exhibit.BarChartView(C,Exhibit.UIContext.create(D,B));
Exhibit.BarChartView._configure(A,D);
A._internalValidate();
A._initializeUI();
return A;
};
Exhibit.BarChartView.createFromDOM=function(D,C,B){var E=Exhibit.getConfigurationFromDOM(D);
var A=new Exhibit.BarChartView(C!=null?C:D,Exhibit.UIContext.createFromDOM(D,B));
Exhibit.SettingsUtilities.createAccessorsFromDOM(D,Exhibit.BarChartView._accessorSpecs,A._accessors);
Exhibit.SettingsUtilities.collectSettingsFromDOM(D,Exhibit.BarChartView._settingSpecs,A._settings);
Exhibit.BarChartView._configure(A,E);
A._internalValidate();
A._initializeUI();
return A;
};
Exhibit.BarChartView._configure=function(A,C){Exhibit.SettingsUtilities.createAccessors(C,Exhibit.BarChartView._accessorSpecs,A._accessors);
Exhibit.SettingsUtilities.collectSettings(C,Exhibit.BarChartView._settingSpecs,A._settings);
A._axisFuncs.x=Exhibit.BarChartView._getAxisFunc(A._settings.xAxisType);
A._axisInverseFuncs.x=Exhibit.BarChartView._getAxisInverseFunc(A._settings.xAxisType);
var B=A._accessors;
A._getXY=function(F,E,D){B.getProxy(F,E,function(G){B.getXY(G,E,D);
});
};
};
Exhibit.BarChartView._getAxisFunc=function(A){if(A=="log"){return function(B){return(Math.log(B)/Math.log(10));
};
}else{return function(B){return B;
};
}};
Exhibit.BarChartView._getAxisInverseFunc=function(A){if(A=="log"){return function(B){return Math.pow(10,B);
};
}else{return function(B){return B;
};
}};
Exhibit.BarChartView._colors=["FF9000","5D7CBA","A97838","8B9BBA","FFC77F","003EBA","29447B","543C1C"];
Exhibit.BarChartView._mixColor="FFFFFF";
Exhibit.BarChartView.evaluateSingle=function(B,C,A){return B.evaluateSingleOnItem(C,A).value;
};
Exhibit.BarChartView.prototype.dispose=function(){this._uiContext.getCollection().removeListener(this._listener);
this._toolboxWidget.dispose();
this._toolboxWidget=null;
this._dom.dispose();
this._dom=null;
this._uiContext.dispose();
this._uiContext=null;
this._div.innerHTML="";
this._div=null;
};
Exhibit.BarChartView.prototype._internalValidate=function(){if("getColorKey" in this._accessors){if("colorCoder" in this._settings){this._colorCoder=this._uiContext.getExhibit().getComponent(this._settings.colorCoder);
}if(this._colorCoder==null){this._colorCoder=new Exhibit.DefaultColorCoder(this._uiContext);
}}};
Exhibit.BarChartView.prototype._initializeUI=function(){var A=this;
var B="_gradientPoints" in this._colorCoder?"gradient":{};
this._div.innerHTML="";
this._dom=Exhibit.ViewUtilities.constructPlottingViewDom(this._div,this._uiContext,true,{onResize:function(){A._reconstruct();
}},B);
this._toolboxWidget=Exhibit.ToolboxWidget.createFromDOM(this._div,this._div,this._uiContext);
this._dom.plotContainer.className="exhibit-barChartView-plotContainer";
this._dom.plotContainer.style.height=this._settings.plotHeight+"px";
this._reconstruct();
};
Exhibit.BarChartView.prototype._reconstruct=function(){var G=this;
var N=this._uiContext.getCollection();
var m=this._uiContext.getDatabase();
var u=this._settings;
var A=this._accessors;
this._dom.plotContainer.innerHTML="";
var P=G._axisFuncs.x;
var p=G._axisInverseFuncs.x;
var Q=N.countRestrictedItems();
var l=[];
this._dom.legendWidget.clear();
if(Q>0){var X=N.getRestrictedItems();
var d=(this._accessors.getColorKey!=null);
var W={};
var R=u.xAxisMin;
var o=u.xAxisMax;
X.visit(function(AD){var AC=[];
G._getXY(AD,m,function(AE){if("x" in AE&&"y" in AE){AC.push(AE);
}});
if(AC.length>0){var x=null;
if(d){x=new Exhibit.Set();
A.getColorKey(AD,m,function(AE){x.add(AE);
});
}for(var y=0;
y<AC.length;
y++){var AB=AC[y];
var z=AB.x+","+AB.y;
if(z in W){var k=W[z];
k.items.push(AD);
if(d){k.colorKeys.addSet(x);
}}else{try{AB.scaledX=P(AB.x);
if(!isFinite(AB.scaledX)){continue;
}}catch(AA){continue;
}var k={xy:AB,items:[AD]};
if(d){k.colorKeys=x;
}W[z]=k;
R=Math.min(R,AB.scaledX);
o=Math.max(o,AB.scaledX);
}}}else{l.push(AD);
}});
var b=o-R;
var M=1;
if(b>1){while(M*20<b){M*=10;
}}else{while(M<b*20){M/=10;
}}R=Math.floor(R/M)*M;
o=Math.ceil(o/M)*M;
u.xAxisMin=R;
u.xAxisMax=o;
var D=document.createElement("div");
D.className=SimileAjax.Platform.browser.isIE?"exhibit-barChartView-canvasFrame-ie":"exhibit-barChartView-canvasFrame";
this._dom.plotContainer.appendChild(D);
if(G._settings.scroll){D.style.overflow="scroll";
}var f=document.createElement("table");
var L=document.createElement("tbody");
var B=document.createElement("tr");
var v=document.createElement("td");
var c=document.createElement("td");
var I=document.createElement("div");
var a=document.createElement("div");
f.style.width="100%";
a.style.position="relative";
a.style.width="100%";
v.appendChild(I);
c.appendChild(a);
B.appendChild(v);
B.appendChild(c);
L.appendChild(B);
f.appendChild(L);
D.appendChild(f);
var J=document.createElement("div");
J.className="exhibit-barChartView-canvas";
J.style.height="100%";
a.appendChild(J);
var h=document.createElement("div");
h.className=SimileAjax.Platform.browser.isIE?"exhibit-barChartView-yAxis-ie":"exhibit-barChartView-yAxis";
this._dom.plotContainer.appendChild(h);
var n=document.createElement("div");
n.style.position="relative";
n.style.height="100%";
h.appendChild(n);
var w=document.createElement("div");
w.className="exhibit-barChartView-yAxisName";
w.innerHTML=u.yLabel;
n.appendChild(w);
var i={mixed:false,missing:false,others:false,keys:new Exhibit.Set()};
var V=function(AB){var AA=AB.items;
var x=u.color;
if(d){x=G._colorCoder.translateSet(AB.colorKeys,i);
}var AE=AB.xy;
var k=document.createElement("div");
var AC=document.createTextNode(AE.y);
k.appendChild(AC);
k.style.height="1.5em";
I.appendChild(k);
var AD=document.createElement("div");
AD.style.position="relative";
AD.style.height="1.5em";
AD.style.zIndex="2";
var z=document.createElement("div");
z.className="exhibit-barChartView-bar";
z.style.backgroundColor=x;
z.style.textAlign="right";
z.style.left="0";
var y=Math.floor(100*(P(AE.x)-R)/(o-R));
z.style.width=y+"%";
z.style.borderStyle="solid";
z.style.borderWidth="1px";
z.style.paddingLeft="0px";
var AC=document.createTextNode(AE.x);
z.appendChild(AC);
AD.appendChild(z);
J.appendChild(AD);
SimileAjax.WindowManager.registerEvent(z,"click",function(AG,AF,AH){G._openPopup(z,AA);
});
SimileAjax.WindowManager.registerEvent(k,"click",function(AG,AF,AH){G._openPopup(k,AA);
});
};
for(xyKey in W){V(W[xyKey]);
}v.style.width="1px";
f.style.tableLayout="auto";
var U=document.createElement("div");
U.className="exhibit-barChartView-xAxis";
var C=document.createElement("div");
C.style.position="relative";
C.style.left=0;
U.appendChild(C);
var E=J.offsetWidth;
var H=J.offsetHeight;
var g=E/(o-R);
J.style.display="none";
var K=function(k,x){if(k>=1000000){return function(y){return Math.floor(x(y)/1000000)+"M";
};
}else{if(k>=1000){return function(y){return Math.floor(x(y)/1000)+"K";
};
}else{return function(y){return x(y);
};
}}};
var e=K(M,p);
for(var j=R+M;
j<o;
j+=M){var F=Math.floor((j-R)*g);
var t=document.createElement("div");
t.className="exhibit-barChartView-gridLine";
t.style.width="1px";
t.style.left=F+"px";
t.style.top="0px";
t.style.height="100%";
t.style.zIndex="1";
J.appendChild(t);
var S=document.createElement("div");
S.className="exhibit-barChartView-xAxisLabel";
S.style.left=F+"px";
S.innerHTML=e(j);
C.appendChild(S);
}var r=document.createElement("div");
r.className="exhibit-barChartView-xAxisName";
r.innerHTML=u.xLabel;
C.appendChild(r);
a.appendChild(U);
J.style.display="block";
if(d){var O=this._dom.legendWidget;
var s=this._colorCoder;
var Y=i.keys.toArray().sort();
if(this._colorCoder._gradientPoints!=null){O.addGradient(this._colorCoder._gradientPoints);
}else{for(var q=0;
q<Y.length;
q++){var T=Y[q];
var Z=s.translate(T);
O.addEntry(Z,T);
}}if(i.others){O.addEntry(s.getOthersColor(),s.getOthersLabel());
}if(i.mixed){O.addEntry(s.getMixedColor(),s.getMixedLabel());
}if(i.missing){O.addEntry(s.getMissingColor(),s.getMissingLabel());
}}}this._dom.setUnplottableMessage(Q,l);
};
Exhibit.BarChartView.prototype._openPopup=function(B,A){Exhibit.ViewUtilities.openBubbleForItems(B,A,this._uiContext);
};


/* pivot-table-view.js */
Exhibit.PivotTableView=function(C,B){this._div=C;
this._uiContext=B;
this._rowPath=null;
this._columnPath=null;
this._cellExpression=null;
this._settings={};
var A=this;
this._listener={onItemsChanged:function(){A._reconstruct();
}};
B.getCollection().addListener(this._listener);
};
Exhibit.PivotTableView.create=function(D,C,B){var A=new Exhibit.PivotTableView(C,Exhibit.UIContext.create(D,B));
Exhibit.PivotTableView._configure(A,D);
A._initializeUI();
return A;
};
Exhibit.PivotTableView.createFromDOM=function(D,C,B){var E=Exhibit.getConfigurationFromDOM(D);
var A=new Exhibit.PivotTableView(C!=null?C:D,Exhibit.UIContext.createFromDOM(D,B));
A._columnPath=Exhibit.PivotTableView._parsePath(Exhibit.getAttribute(D,"column"));
A._rowPath=Exhibit.PivotTableView._parsePath(Exhibit.getAttribute(D,"row"));
A._cellExpression=Exhibit.PivotTableView._parseExpression(Exhibit.getAttribute(D,"cell"));
Exhibit.PivotTableView._configure(A,E);
A._initializeUI();
return A;
};
Exhibit.PivotTableView._configure=function(A,B){if("column" in B){A._columnPath=Exhibit.PivotTableView._parsePath(B.column);
}if("row" in B){A._rowPath=Exhibit.PivotTableView._parsePath(B.row);
}if("cell" in B){A._cellExpression=Exhibit.PivotTableView._parseExpression(B.cell);
}};
Exhibit.PivotTableView._parseExpression=function(A){try{return Exhibit.ExpressionParser.parse(A);
}catch(B){SimileAjax.Debug.exception(B,"Error parsing expression "+A);
}return null;
};
Exhibit.PivotTableView._parsePath=function(A){try{var C=Exhibit.ExpressionParser.parse(A);
if(C.isPath()){return C.getPath();
}else{SimileAjax.Debug.log("Expecting a path but got a full expression: "+A);
}}catch(B){SimileAjax.Debug.exception(B,"Error parsing expression "+A);
}return null;
};
Exhibit.PivotTableView.prototype.dispose=function(){this._uiContext.getCollection().removeListener(this._listener);
this._toolboxWidget.dispose();
this._toolboxWidget=null;
this._collectionSummaryWidget.dispose();
this._collectionSummaryWidget=null;
this._uiContext.dispose();
this._uiContext=null;
this._div.innerHTML="";
this._dom=null;
this._div=null;
};
Exhibit.PivotTableView.prototype._initializeUI=function(){var A=this;
this._div.innerHTML="";
this._dom=Exhibit.PivotTableView.constructDom(this._div);
this._collectionSummaryWidget=Exhibit.CollectionSummaryWidget.create({},this._dom.collectionSummaryDiv,this._uiContext);
this._toolboxWidget=Exhibit.ToolboxWidget.createFromDOM(this._div,this._div,this._uiContext);
this._reconstruct();
};
Exhibit.PivotTableView.prototype._reconstruct=function(){this._dom.tableContainer.innerHTML="";
var A=this._uiContext.getCollection().countRestrictedItems();
if(A>0){var B=this._uiContext.getCollection().getRestrictedItems();
if(this._columnPath!=null&&this._rowPath!=null&&this._cellExpression!=null){this._makeTable(B);
}}};
Exhibit.PivotTableView.prototype._makeTable=function(Q){var R=this;
var N=this._uiContext.getDatabase();
var D=this._rowPath.walkForward(Q,"item",N).getSet();
var I=this._columnPath.walkForward(Q,"item",N).getSet();
var S=Exhibit.PivotTableView._sortValues(D);
var K=Exhibit.PivotTableView._sortValues(I);
var L=S.length;
var T=K.length;
var P="#eee";
var E="#fff";
var Y=document.createElement("table");
Y.cellPadding=2;
Y.cellSpacing=0;
var W=0;
var A,J;
for(var Z=0;
Z<T;
Z++){var C=0;
A=Y.insertRow(W++);
J=A.insertCell(C++);
if(Z>0){J=A.insertCell(C++);
J.rowSpan=T-Z+1;
J.style.backgroundColor=(Z%2)==0?E:P;
J.innerHTML="\u00a0";
}J=A.insertCell(C++);
J.colSpan=T-Z+1;
J.style.backgroundColor=(Z%2)==1?E:P;
J.innerHTML=K[Z].label;
}A=Y.insertRow(W++);
J=A.insertCell(0);
J=A.insertCell(1);
J.style.backgroundColor=(T%2)==0?E:P;
J.innerHTML="\u00a0";
J=A.insertCell(2);
for(var O=0;
O<L;
O++){var C=0;
var B=S[O];
var X=B.value;
A=Y.insertRow(W++);
J=A.insertCell(C++);
J.innerHTML=S[O].label;
J.style.borderBottom="1px solid #aaa";
var V=this._rowPath.evaluateBackward(X,D.valueType,Q,N).getSet();
for(var Z=0;
Z<T;
Z++){var U=K[Z];
var G=U.value;
J=A.insertCell(C++);
J.style.backgroundColor=(Z%2)==1?E:P;
J.style.borderBottom="1px solid #ccc";
J.title=B.label+" / "+U.label;
var F=this._columnPath.evaluateBackward(G,I.valueType,V,N);
var M=this._cellExpression.evaluate({"value":F.getSet()},{"value":F.valueType},"value",N);
if(M.valueType=="number"&&M.values.size()==1){M.values.visit(function(a){if(a!=0){J.appendChild(document.createTextNode(a));
}else{J.appendChild(document.createTextNode("\u00a0"));
}});
}else{var H=true;
M.values.visit(function(a){if(H){H=false;
}else{J.appendChild(document.createTextNode(", "));
}J.appendChild(document.createTextNode(a));
});
}}}this._dom.tableContainer.appendChild(Y);
};
Exhibit.PivotTableView._sortValues=function(B,D,C){var A=[];
B.visit(D=="item"?function(E){var F=C.getObject(E,"label");
A.push({value:E,label:F!=null?F:E});
}:function(E){A.push({value:E,label:E});
});
A.sort(function(F,E){var G=F.label.localeCompare(E.label);
return G!=null?G:F.value.localeCompare(E.value);
});
return A;
};
Exhibit.PivotTableView.prototype._openPopup=function(B,F){var I=SimileAjax.DOM.getPageCoordinates(B);
var A=SimileAjax.Graphics.createBubbleForPoint(I.left+Math.round(B.offsetWidth/2),I.top+Math.round(B.offsetHeight/2),400,300);
if(F.length>1){var E=document.createElement("ul");
for(var D=0;
D<F.length;
D++){var H=document.createElement("li");
H.appendChild(Exhibit.UI.makeItemSpan(F[D],null,this._uiContext));
E.appendChild(H);
}A.content.appendChild(E);
}else{var G=document.createElement("div");
var C=this._uiContext.getLensRegistry().createLens(F[0],G,this._uiContext);
A.content.appendChild(G);
}};
Exhibit.PivotTableView.constructDom=function(C){var B=Exhibit.PivotTableView.l10n;
var A={elmt:C,children:[{tag:"div",className:"exhibit-collectionView-header",field:"collectionSummaryDiv"},{tag:"div",field:"tableContainer",className:"exhibit-pivotTableView-tableContainer"}]};
return SimileAjax.DOM.createDOMFromTemplate(A);
};


/* scatter-plot-view.js */
Exhibit.ScatterPlotView=function(C,B){this._div=C;
this._uiContext=B;
this._settings={};
this._accessors={getPointLabel:function(F,E,D){D(E.getObject(F,"label"));
},getProxy:function(F,E,D){D(F);
},getColorKey:null};
this._axisFuncs={x:function(D){return D;
},y:function(D){return D;
}};
this._axisInverseFuncs={x:function(D){return D;
},y:function(D){return D;
}};
this._colorKeyCache=new Object();
this._maxColor=0;
var A=this;
this._listener={onItemsChanged:function(){A._reconstruct();
}};
B.getCollection().addListener(this._listener);
};
Exhibit.ScatterPlotView._settingSpecs={"plotHeight":{type:"int",defaultValue:400},"bubbleWidth":{type:"int",defaultValue:400},"bubbleHeight":{type:"int",defaultValue:300},"xAxisMin":{type:"float",defaultValue:Number.POSITIVE_INFINITY},"xAxisMax":{type:"float",defaultValue:Number.NEGATIVE_INFINITY},"xAxisType":{type:"enum",defaultValue:"linear",choices:["linear","log"]},"yAxisMin":{type:"float",defaultValue:Number.POSITIVE_INFINITY},"yAxisMax":{type:"float",defaultValue:Number.NEGATIVE_INFINITY},"yAxisType":{type:"enum",defaultValue:"linear",choices:["linear","log"]},"xLabel":{type:"text",defaultValue:"x"},"yLabel":{type:"text",defaultValue:"y"},"color":{type:"text",defaultValue:"#0000aa"},"colorCoder":{type:"text",defaultValue:null}};
Exhibit.ScatterPlotView._accessorSpecs=[{accessorName:"getProxy",attributeName:"proxy"},{accessorName:"getPointLabel",attributeName:"pointLabel"},{accessorName:"getXY",alternatives:[{bindings:[{attributeName:"xy",types:["float","float"],bindingNames:["x","y"]}]},{bindings:[{attributeName:"x",type:"float",bindingName:"x"},{attributeName:"y",type:"float",bindingName:"y"}]}]},{accessorName:"getColorKey",attributeName:"colorKey",type:"text"}];
Exhibit.ScatterPlotView.create=function(D,C,B){var A=new Exhibit.ScatterPlotView(C,Exhibit.UIContext.create(D,B));
Exhibit.ScatterPlotView._configure(A,D);
A._internalValidate();
A._initializeUI();
return A;
};
Exhibit.ScatterPlotView.createFromDOM=function(D,C,B){var E=Exhibit.getConfigurationFromDOM(D);
var A=new Exhibit.ScatterPlotView(C!=null?C:D,Exhibit.UIContext.createFromDOM(D,B));
Exhibit.SettingsUtilities.createAccessorsFromDOM(D,Exhibit.ScatterPlotView._accessorSpecs,A._accessors);
Exhibit.SettingsUtilities.collectSettingsFromDOM(D,Exhibit.ScatterPlotView._settingSpecs,A._settings);
Exhibit.ScatterPlotView._configure(A,E);
A._internalValidate();
A._initializeUI();
return A;
};
Exhibit.ScatterPlotView._configure=function(A,C){Exhibit.SettingsUtilities.createAccessors(C,Exhibit.ScatterPlotView._accessorSpecs,A._accessors);
Exhibit.SettingsUtilities.collectSettings(C,Exhibit.ScatterPlotView._settingSpecs,A._settings);
A._axisFuncs.x=Exhibit.ScatterPlotView._getAxisFunc(A._settings.xAxisType);
A._axisInverseFuncs.x=Exhibit.ScatterPlotView._getAxisInverseFunc(A._settings.xAxisType);
A._axisFuncs.y=Exhibit.ScatterPlotView._getAxisFunc(A._settings.yAxisType);
A._axisInverseFuncs.y=Exhibit.ScatterPlotView._getAxisInverseFunc(A._settings.yAxisType);
var B=A._accessors;
A._getXY=function(F,E,D){B.getProxy(F,E,function(G){B.getXY(G,E,D);
});
};
};
Exhibit.ScatterPlotView._getAxisFunc=function(A){if(A=="log"){return function(B){return(Math.log(B)/Math.log(10));
};
}else{return function(B){return B;
};
}};
Exhibit.ScatterPlotView._getAxisInverseFunc=function(A){if(A=="log"){return function(B){return Math.pow(10,B);
};
}else{return function(B){return B;
};
}};
Exhibit.ScatterPlotView._colors=["FF9000","5D7CBA","A97838","8B9BBA","FFC77F","003EBA","29447B","543C1C"];
Exhibit.ScatterPlotView._mixColor="FFFFFF";
Exhibit.ScatterPlotView.evaluateSingle=function(B,C,A){return B.evaluateSingleOnItem(C,A).value;
};
Exhibit.ScatterPlotView.prototype.dispose=function(){this._uiContext.getCollection().removeListener(this._listener);
this._toolboxWidget.dispose();
this._toolboxWidget=null;
this._dom.dispose();
this._dom=null;
this._uiContext.dispose();
this._uiContext=null;
this._div.innerHTML="";
this._div=null;
};
Exhibit.ScatterPlotView.prototype._internalValidate=function(){if("getColorKey" in this._accessors){if("colorCoder" in this._settings){this._colorCoder=this._uiContext.getExhibit().getComponent(this._settings.colorCoder);
}if(this._colorCoder==null){this._colorCoder=new Exhibit.DefaultColorCoder(this._uiContext);
}}};
Exhibit.ScatterPlotView.prototype._initializeUI=function(){var A=this;
var B="_gradientPoints" in this._colorCoder?"gradient":{};
this._div.innerHTML="";
this._dom=Exhibit.ViewUtilities.constructPlottingViewDom(this._div,this._uiContext,true,{onResize:function(){A._reconstruct();
}},B);
this._toolboxWidget=Exhibit.ToolboxWidget.createFromDOM(this._div,this._div,this._uiContext);
this._dom.plotContainer.className="exhibit-scatterPlotView-plotContainer";
this._dom.plotContainer.style.height=this._settings.plotHeight+"px";
this._reconstruct();
};
Exhibit.ScatterPlotView.prototype._reconstruct=function(){var H=this;
var N=this._uiContext.getCollection();
var o=this._uiContext.getDatabase();
var z=this._settings;
var A=this._accessors;
this._dom.plotContainer.innerHTML="";
var Q=H._axisFuncs.x;
var R=H._axisFuncs.y;
var r=H._axisInverseFuncs.x;
var t=H._axisInverseFuncs.y;
var S=N.countRestrictedItems();
var n=[];
this._dom.legendWidget.clear();
if(S>0){var Y=N.getRestrictedItems();
var d=(this._accessors.getColorKey!=null);
var X={};
var T=z.xAxisMin;
var q=z.xAxisMax;
var i=z.yAxisMin;
var I=z.yAxisMax;
Y.visit(function(AG){var AF=[];
H._getXY(AG,o,function(AH){if("x" in AH&&"y" in AH){AF.push(AH);
}});
if(AF.length>0){var x=null;
if(d){x=new Exhibit.Set();
A.getColorKey(AG,o,function(AH){x.add(AH);
});
}for(var y=0;
y<AF.length;
y++){var AE=AF[y];
var AC=AE.x+","+AE.y;
if(AC in X){var k=X[AC];
k.items.push(AG);
if(d){k.colorKeys.addSet(x);
}}else{try{AE.scaledX=Q(AE.x);
AE.scaledY=R(AE.y);
if(!isFinite(AE.scaledX)||!isFinite(AE.scaledY)){continue;
}}catch(AD){continue;
}var k={xy:AE,items:[AG]};
if(d){k.colorKeys=x;
}X[AC]=k;
T=Math.min(T,AE.scaledX);
q=Math.max(q,AE.scaledX);
i=Math.min(i,AE.scaledY);
I=Math.max(I,AE.scaledY);
}}}else{n.push(AG);
}});
var b=q-T;
var P=I-i;
var M=1;
if(b>1){while(M*20<b){M*=10;
}}else{while(M<b*20){M/=10;
}}T=Math.floor(T/M)*M;
q=Math.ceil(q/M)*M;
var D=1;
if(P>1){while(D*20<P){D*=10;
}}else{while(D<P*20){D/=10;
}}i=Math.floor(i/D)*D;
I=Math.ceil(I/D)*D;
z.xAxisMin=T;
z.xAxisMax=q;
z.yAxisMin=i;
z.yAxisMax=I;
var C=document.createElement("div");
C.className=SimileAjax.Platform.browser.isIE?"exhibit-scatterPlotView-canvasFrame-ie":"exhibit-scatterPlotView-canvasFrame";
this._dom.plotContainer.appendChild(C);
var K=document.createElement("div");
K.className="exhibit-scatterPlotView-canvas";
K.style.height="100%";
C.appendChild(K);
var W=document.createElement("div");
W.className="exhibit-scatterPlotView-xAxis";
this._dom.plotContainer.appendChild(W);
var B=document.createElement("div");
B.style.position="relative";
W.appendChild(B);
var h=document.createElement("div");
h.className=SimileAjax.Platform.browser.isIE?"exhibit-scatterPlotView-yAxis-ie":"exhibit-scatterPlotView-yAxis";
this._dom.plotContainer.appendChild(h);
var p=document.createElement("div");
p.style.position="relative";
p.style.height="100%";
h.appendChild(p);
var E=K.offsetWidth;
var J=K.offsetHeight;
var g=E/(q-T);
var G=J/(I-i);
K.style.display="none";
var L=function(k,x){if(k>=1000000){return function(y){return Math.floor(x(y)/1000000)+"M";
};
}else{if(k>=1000){return function(y){return Math.floor(x(y)/1000)+"K";
};
}else{return function(y){return x(y);
};
}}};
var f=L(M,r);
var e=L(D,t);
for(var m=T+M;
m<q;
m+=M){var F=Math.floor((m-T)*g);
var w=document.createElement("div");
w.className="exhibit-scatterPlotView-gridLine";
w.style.width="1px";
w.style.left=F+"px";
w.style.top="0px";
w.style.height="100%";
K.appendChild(w);
var U=document.createElement("div");
U.className="exhibit-scatterPlotView-xAxisLabel";
U.style.left=F+"px";
U.innerHTML=f(m);
B.appendChild(U);
}var u=document.createElement("div");
u.className="exhibit-scatterPlotView-xAxisName";
u.innerHTML=z.xLabel;
B.appendChild(u);
for(var l=i+D;
l<I;
l+=D){var AA=Math.floor((l-i)*G);
var w=document.createElement("div");
w.className="exhibit-scatterPlotView-gridLine";
w.style.height="1px";
w.style.bottom=AA+"px";
w.style.left="0px";
w.style.width="100%";
K.appendChild(w);
var U=document.createElement("div");
U.className="exhibit-scatterPlotView-yAxisLabel";
U.style.bottom=AA+"px";
U.innerHTML=e(l);
p.appendChild(U);
}var AB=document.createElement("div");
AB.className="exhibit-scatterPlotView-yAxisName";
AB.innerHTML=z.yLabel;
p.appendChild(AB);
var j={mixed:false,missing:false,others:false,keys:new Exhibit.Set()};
var c=function(k){var y=k.items;
var x=z.color;
if(d){x=H._colorCoder.translateSet(k.colorKeys,j);
}var AD=k.xy;
var AC=Exhibit.ScatterPlotView._makePoint(x,Math.floor((AD.scaledX-T)*g),Math.floor((AD.scaledY-i)*G),k.items+": "+z.xLabel+" = "+AD.x+", "+z.yLabel+" = "+AD.y);
SimileAjax.WindowManager.registerEvent(AC,"click",function(AF,AE,AG){H._openPopup(AC,y);
});
K.appendChild(AC);
};
for(xyKey in X){c(X[xyKey]);
}K.style.display="block";
if(d){var O=this._dom.legendWidget;
var v=this._colorCoder;
var Z=j.keys.toArray().sort();
if(this._colorCoder._gradientPoints!=null){O.addGradient(this._colorCoder._gradientPoints);
}else{for(var s=0;
s<Z.length;
s++){var V=Z[s];
var a=v.translate(V);
O.addEntry(a,V);
}}if(j.others){O.addEntry(v.getOthersColor(),v.getOthersLabel());
}if(j.mixed){O.addEntry(v.getMixedColor(),v.getMixedLabel());
}if(j.missing){O.addEntry(v.getMissingColor(),v.getMissingLabel());
}}}this._dom.setUnplottableMessage(S,n);
};
Exhibit.ScatterPlotView.prototype._openPopup=function(B,A){Exhibit.ViewUtilities.openBubbleForItems(B,A,this._uiContext);
};
Exhibit.ScatterPlotView._makePoint=function(B,E,D,A){var C=document.createElement("div");
C.innerHTML="<div class='exhibit-scatterPlotView-point' style='background: "+B+"; width: 6px; height: 6px; left: "+(E-3)+"px; bottom: "+(D+3)+"px;' title='"+A+"'></div>";
return C.firstChild;
};
